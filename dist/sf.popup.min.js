/*!
 * Popup module v.0.0.0
 * https://github.com/sfjs/sf-module-autocomplete/
 * Copyright (c) 2016, Yauheni Yasinau, spiralscout.com
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("sf"));else if("function"==typeof define&&define.amd)define(["sf"],t);else{var n=t("object"==typeof exports?require("sf"):e.sf);for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var r=n(1),i=o(r),s=n(2),a=o(s);n(18),i["default"].instancesController.registerInstanceType(a["default"],"js-sf-popup"),e.exports=a["default"]},function(t,n){t.exports=e},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var r=n(3),i=o(r),s=n(1),a=o(s),p=function(e,t,n){this._construct(e,t,n)};p.prototype=a["default"].createModulePrototype(),p.prototype.name="popup",p.prototype._construct=function(e,t,n){this.init(e,t,n),n&&(this.options=(0,i["default"])(this.options,n)),this.data={},this.els={node:t,modal:document.createElement("div"),backdrop:document.createElement("div"),template:document.querySelector(this.options.templateSelector)},this.modalReady=!1,this.templateRequested=!1,this.pattern=new RegExp("\\"+this.options.delimiters[0]+".*?(?="+this.options.delimiters[1]+")"+this.options.delimiters[1]),this.matches=[],this.options.data||this.options.url||console.warn("No data or URL to fetch data provided"),this.options.templateSelector||this.options.templateURL||console.warn("No template selector or URL provided"),!this.els.template&&this.options.templateSelector&&console.warn("No template found with provided selector"),this.els.modal.classList.add("sf-popup-modal"),this.els.backdrop.classList.add("sf-popup-backdrop"),this.addEventListeners()},p.prototype.optionsToGrab={url:{value:!1,domAttr:"data-url"},responseDataName:{value:"data",domAttr:"data-response-data-name"},responseTemplateName:{value:"template",domAttr:"data-response-template-name"},delimiters:{value:"{{,}}",domAttr:"data-delimiters",processor:function(e,t){return t.split(",")}},data:{value:!1,domAttr:"data-data",processor:function(e,t,n){if(!t)return this.value;if("string"==typeof t)try{t=JSON.parse(t)}catch(o){console.error("Popup data JSON.parse error: ",o)}return(0,i["default"])(n.value,t)}},templateSelector:{value:!1,domAttr:"data-template"},templateURL:{value:!1,domAttr:"data-template-url"}},p.prototype.deepObjectValue=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var n=t.split("."),o=0,r=n.length;r>o;++o){var i=n[o];if(!(i in e))return;e=e[i]}return e},p.prototype.parseTemplate=function(){for(var e,t,n=this,o=this.els.template.innerHTML;e=this.pattern.exec(o);)t=e[0].substring(n.options.delimiters[0].length,e[0].length-n.options.delimiters[1].length),this.matches.push(t),o=o.replace(e[0],n.deepObjectValue(n.data,t)||"");this.els.modal.innerHTML=o,this.modalReady=!0,this.openPopup(!0)},p.prototype.runInternalScripts=function(e){var t=this.els.modal.getElementsByTagName("script");window.scripts=t;for(var n=0;n<t.length;n++){var o=t[n],r=o.parentElement,i=document.createElement("script");if("undefined"!=typeof o.dataset.initial){if(e)continue;i.dataset.initial=o.dataset.initial}i.innerHTML=o.innerHTML,r.insertBefore(i,o),r.removeChild(o)}},p.prototype.generatePopup=function(){this.modalReady?this.openPopup():this.fetchData()},p.prototype.fetchData=function(){var e=this;this.els.template?this.options.url?a["default"].ajax.send({url:this.options.url}).then(function(t){(0,i["default"])(e.data,t[e.options.responseDataName],e.options.data),e.parseTemplate()},function(e){return console.warn("Error has occured during fetching data from given URL"),e}):((0,i["default"])(e.data,e.options.data),this.parseTemplate()):this.options.templateURL&&!this.templateRequested&&(this.templateRequested=!0,a["default"].ajax.send({url:this.options.templateURL}).then(function(t){e.els.template=document.createElement("div"),e.els.template.innerHTML=t[e.options.responseTemplateName],e.fetchData()},function(e){return console.warn("Error has occurred during fetching template from given URL"),e}))},p.prototype.openPopup=function(e){e="undefined"!=typeof e;var t=this;document.body.appendChild(this.els.modal),document.body.appendChild(this.els.backdrop),this.runInternalScripts(!e),setTimeout(function(){t.els.modal.classList.add("visible"),t.els.backdrop.classList.add("visible")},0)},p.prototype.closePopup=function(){var e=this;this.els.modal.classList.remove("visible"),this.els.backdrop.classList.remove("visible"),setTimeout(function(){e.els.modal.parentNode.removeChild(e.els.modal),e.els.backdrop.parentNode.removeChild(e.els.backdrop)},300)},p.prototype.addEventListeners=function(){var e=this;this._generatePopup=function(){e.generatePopup()},this._closePopup=function(){e.closePopup()},this.els.node&&this.els.node.addEventListener("click",this._generatePopup),this.els.backdrop&&this.els.backdrop.addEventListener("click",this._closePopup)},p.prototype.removeEventListeners=function(){this.els.node&&this.els.node.removeEventListener("change",this._generatePopup),this.els.backdrop&&this.els.backdrop.removeEventListener("click",this._closePopup)},p.prototype.die=function(){this.removeEventListeners(),delete this},e.exports=p},function(e,t,n){e.exports={"default":n(4),__esModule:!0}},function(e,t,n){n(5),e.exports=n(8).Object.assign},function(e,t,n){var o=n(6);o(o.S+o.F,"Object",{assign:n(11)})},function(e,t,n){var o=n(7),r=n(8),i=n(9),s="prototype",a=function(e,t,n){var p,u,l,c=e&a.F,d=e&a.G,f=e&a.S,h=e&a.P,m=e&a.B,v=e&a.W,y=d?r:r[t]||(r[t]={}),g=d?o:f?o[t]:(o[t]||{})[s];d&&(n=t);for(p in n)u=!c&&g&&p in g,u&&p in y||(l=u?g[p]:n[p],y[p]=d&&"function"!=typeof g[p]?n[p]:m&&u?i(l,o):v&&g[p]==l?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[s]=e[s],t}(l):h&&"function"==typeof l?i(Function.call,l):l,h&&((y[s]||(y[s]={}))[p]=l))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,e.exports=a},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t,n){var o=n(10);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,r){return e.call(t,n,o,r)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var o=n(12),r=n(13),i=n(15);e.exports=n(17)(function(){var e=Object.assign,t={},n={},o=Symbol(),r="abcdefghijklmnopqrst";return t[o]=7,r.split("").forEach(function(e){n[e]=e}),7!=e({},t)[o]||Object.keys(e({},n)).join("")!=r})?function(e,t){for(var n=r(e),s=arguments,a=s.length,p=1,u=o.getKeys,l=o.getSymbols,c=o.isEnum;a>p;)for(var d,f=i(s[p++]),h=l?u(f).concat(l(f)):u(f),m=h.length,v=0;m>v;)c.call(f,d=h[v++])&&(n[d]=f[d]);return n}:Object.assign},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t,n){var o=n(14);e.exports=function(e){return Object(o(e))}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var o=n(16);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,n){var o=n(19);"string"==typeof o&&(o=[[e.id,o,""]]);n(21)(o,{});o.locals&&(e.exports=o.locals)},function(e,t,n){t=e.exports=n(20)(),t.push([e.id,".sf-popup-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);padding:20px;background-color:#fff;overflow:auto;z-index:1000;width:auto;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0;transition:opacity .3s ease;box-shadow:0 16px 28px 0 rgba(0,0,0,.22),0 25px 55px 0 rgba(0,0,0,.21)}.sf-popup-modal.visible{opacity:1;z-index:1001}.sf-popup-backdrop{top:0;left:0;position:fixed;background-color:#000;width:100vw;height:100vh;opacity:0;transition:opacity .3s ease}.sf-popup-backdrop.visible{opacity:.4;z-index:1000}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},r=0;r<this.length;r++){var i=this[r][0];"number"==typeof i&&(o[i]=!0)}for(r=0;r<t.length;r++){var s=t[r];"number"==typeof s[0]&&o[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),e.push(s))}},e}},function(e,t,n){function o(e,t){for(var n=0;n<e.length;n++){var o=e[n],r=f[o.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](o.parts[i]);for(;i<o.parts.length;i++)r.parts.push(u(o.parts[i],t))}else{for(var s=[],i=0;i<o.parts.length;i++)s.push(u(o.parts[i],t));f[o.id]={id:o.id,refs:1,parts:s}}}}function r(e){for(var t=[],n={},o=0;o<e.length;o++){var r=e[o],i=r[0],s=r[1],a=r[2],p=r[3],u={css:s,media:a,sourceMap:p};n[i]?n[i].parts.push(u):t.push(n[i]={id:i,parts:[u]})}return t}function i(e,t){var n=v(),o=b[b.length-1];if("top"===e.insertAt)o?o.nextSibling?n.insertBefore(t,o.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),b.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function s(e){e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function a(e){var t=document.createElement("style");return t.type="text/css",i(e,t),t}function p(e){var t=document.createElement("link");return t.rel="stylesheet",i(e,t),t}function u(e,t){var n,o,r;if(t.singleton){var i=g++;n=y||(y=a(t)),o=l.bind(null,n,i,!1),r=l.bind(null,n,i,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=p(t),o=d.bind(null,n),r=function(){s(n),n.href&&URL.revokeObjectURL(n.href)}):(n=a(t),o=c.bind(null,n),r=function(){s(n)});return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else r()}}function l(e,t,n,o){var r=n?"":o.css;if(e.styleSheet)e.styleSheet.cssText=x(t,r);else{var i=document.createTextNode(r),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(i,s[t]):e.appendChild(i)}}function c(e,t){var n=t.css,o=t.media;t.sourceMap;if(o&&e.setAttribute("media",o),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function d(e,t){var n=t.css,o=(t.media,t.sourceMap);o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var r=new Blob([n],{type:"text/css"}),i=e.href;e.href=URL.createObjectURL(r),i&&URL.revokeObjectURL(i)}var f={},h=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},m=h(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=h(function(){return document.head||document.getElementsByTagName("head")[0]}),y=null,g=0,b=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=m()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var n=r(e);return o(n,t),function(e){for(var i=[],s=0;s<n.length;s++){var a=n[s],p=f[a.id];p.refs--,i.push(p)}if(e){var u=r(e);o(u,t)}for(var s=0;s<i.length;s++){var p=i[s];if(0===p.refs){for(var l=0;l<p.parts.length;l++)p.parts[l]();delete f[p.id]}}}};var x=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()}])});
//# sourceMappingURL=sf.popup.min.js.map